<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Math Night — Korku / Matematik (GitHub Pages)</title>
<style>
  :root{
    --bg:#08060a;
    --panel:#0f1115;
    --accent:#e04b4b;
    --text:#e8e8e8;
    --muted:#9aa0a6;
  }
  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Arial;background:linear-gradient(180deg,#020203 0%, #081018 60%);color:var(--text)}
  .container{max-width:980px;margin:18px auto;padding:16px;display:grid;grid-template-columns:1fr 360px;gap:18px;}
  header{grid-column:1/-1;display:flex;justify-content:space-between;align-items:center}
  h1{margin:0;font-size:20px;letter-spacing:0.6px}
  .game{
    background:linear-gradient(180deg,#0b0e13,#0a0b0f);border-radius:10px;padding:12px;box-shadow:0 6px 30px rgba(0,0,0,0.7);
  }
  .left{
    display:grid;grid-template-rows: 220px 1fr;gap:12px;
  }
  /* Cameras area */
  .cams{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;height:100%}
  .cam{
    background:linear-gradient(180deg,#071019,#09121a);border-radius:8px;padding:8px;position:relative;overflow:hidden;border:1px solid rgba(255,255,255,0.03)
  }
  .cam .label{position:absolute;left:8px;top:8px;background:#0006;padding:4px 8px;border-radius:6px;font-size:12px}
  .cam canvas{width:100%;height:100%;display:block;border-radius:6px}
  /* right panel */
  .right{
    display:flex;flex-direction:column;gap:12px;
  }
  .panel{
    background:var(--panel);padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03)
  }
  .status-row{display:flex;justify-content:space-between;gap:8px;align-items:center}
  .meter{height:12px;background:#071018;border-radius:999px;overflow:hidden;flex:1;margin-left:8px}
  .meter > i{display:block;height:100%;background:linear-gradient(90deg,#7ae582,#3bd67a);width:100%}
  .controls{display:flex;gap:8px;margin-top:8px}
  button{background:#0d1115;border:1px solid rgba(255,255,255,0.03);color:var(--text);padding:8px 10px;border-radius:6px;cursor:pointer}
  button.warn{background:var(--accent);color:white}
  .log{height:140px;overflow:auto;background:#05060a;padding:8px;border-radius:6px;font-family:monospace;font-size:13px;color:var(--muted)}
  .big-timer{font-size:32px;font-weight:700;letter-spacing:1px}
  footer{grid-column:1/-1;margin-top:6px;text-align:center;color:var(--muted);font-size:13px}
  /* modal */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:40}
  .card{background:#0b0f12;padding:18px;border-radius:10px;width:92%;max-width:520px;border:1px solid rgba(255,255,255,0.04)}
  .question{font-size:20px;margin-bottom:8px}
  input[type="text"]{width:100%;padding:10px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:#061018;color:var(--text);font-size:16px}
  .row{display:flex;gap:8px;align-items:center;margin-top:10px}
  .hint{color:var(--muted);font-size:13px}
  @media(max-width:900px){
    .container{grid-template-columns:1fr; padding:8px}
    .right{order:2}
  }
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>Math Night — Matematik Korku (GitHub Pages için)</h1>
    <div style="text-align:right">
      <div style="font-size:12px;color:var(--muted)">Geliştirici: ChatGPT • Tek dosya</div>
    </div>
  </header>

  <div class="game left">
    <div class="cams panel">
      <div class="cam" data-cam="A">
        <div class="label">CAM A - Lobby</div>
        <canvas id="camA"></canvas>
      </div>
      <div class="cam" data-cam="B">
        <div class="label">CAM B - Hall</div>
        <canvas id="camB"></canvas>
      </div>
      <div class="cam" data-cam="C">
        <div class="label">CAM C - Stage</div>
        <canvas id="camC"></canvas>
      </div>
      <div class="cam" data-cam="D">
        <div class="label">CAM D - Door</div>
        <canvas id="camD"></canvas>
      </div>
    </div>

    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-size:14px">Gece</div>
          <div class="big-timer" id="timer">60</div>
        </div>
        <div style="text-align:right">
          <div style="font-size:12px;color:var(--muted)">Animatronik sayısı</div>
          <div style="font-size:20px;font-weight:700" id="enemies">3</div>
        </div>
      </div>

      <div style="margin-top:10px" class="status-row">
        <div>Enerji</div>
        <div class="meter" style="flex:1">
          <i id="energyBar" style="width:100%"></i>
        </div>
        <div id="energyPercent" style="min-width:40px;text-align:right">100%</div>
      </div>

      <div class="controls">
        <button id="toggleCam">Kamera Aç/Kapa</button>
        <button id="closeLeft">Sol Kapı Kapat</button>
        <button id="closeRight">Sağ Kapı Kapat</button>
        <button id="startBtn" class="warn">Başla</button>
      </div>
      <div style="margin-top:8px;font-size:13px;color:var(--muted)">Kamera açıkken animatroniklerin hareketi yavaşlar. Onları durdurmak için soruları cevapla.</div>
    </div>
  </div>

  <aside class="right">
    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-size:13px;color:var(--muted)">Kamera Durumu</div>
          <div id="camState">Kapalı</div>
        </div>
        <div>
          <div style="font-size:13px;color:var(--muted)">Kapılar</div>
          <div id="doors">Açık / Açık</div>
        </div>
      </div>
      <div style="margin-top:8px">
        <div style="font-size:13px;color:var(--muted)">Günlük Kayıt</div>
        <div class="log" id="log"></div>
      </div>
    </div>

    <div class="panel" style="text-align:center">
      <div style="font-size:14px;color:var(--muted)">Hızlı Açıklama</div>
      <ul style="text-align:left;margin:8px 0;padding-left:18px;color:var(--muted);font-size:13px">
        <li>Kamera açmak: hafif enerji tüketir, hareketi yavaşlatır.</li>
        <li>Kapı kapamak: enerji çok tüketir ama animatronikleri engeller.</li>
        <li>Animatronik sana yaklaşıp kapıyı aşarsa oyun biter.</li>
        <li>Animatronik durdurmak için çıkan matematik sorusunu hızlıca doğru cevapla.</li>
      </ul>
      <div style="font-size:12px;color:var(--muted)">İyi şanslar...</div>
    </div>
  </aside>

  <footer>
    Bu oyun tek HTML dosyasıdır — GitHub Pages'e koyup hemen oynayabilirsin.
  </footer>
</div>

<!-- Modal soru -->
<div id="modal" class="modal" style="display:none">
  <div class="card">
    <div class="question" id="qText">Soru buraya</div>
    <input id="qInput" type="text" autocomplete="off" placeholder="Cevabını yaz ve Enter'a bas" />
    <div class="row">
      <div class="hint" id="qHint">Kalan süre: <span id="qTime">10</span>s</div>
      <div style="flex:1"></div>
      <button id="submitAns" class="warn">Gönder</button>
    </div>
  </div>
</div>

<script>
/*
  Math Night — Basit FNAF-benzeri oyun
  Tek dosya — GitHub Pages ile uyumlu
*/

/* --- Oyun ayarları --- */
const NIGHT_SECONDS = 60;           // gece süresi kazanmak için
const INITIAL_ENERGY = 100;         // başlangıç enerji %
const ENERGY_CAMERA_PER_SEC = 0.6;  // kamera açıkken saniye başına enerji kaybı
const ENERGY_DOOR_PER_SEC = 2.4;    // kapı kapalıysa saniye başına enerji kaybı
const ANIM_COUNT = 3;               // animatronik sayısı
const QUESTION_TIME = 12;           // soru için verilecek saniye

/* --- Oyun durumları --- */
let state = {
  running: false,
  timeLeft: NIGHT_SECONDS,
  energy: INITIAL_ENERGY,
  cameraOn: false,
  doorLeft: false,
  doorRight: false,
  enemies: [],
  tickInterval: null,
  Q: null,
};

/* --- UI elemanları --- */
const timerEl = document.getElementById('timer');
const energyBar = document.getElementById('energyBar');
const energyPercent = document.getElementById('energyPercent');
const camState = document.getElementById('camState');
const doorsEl = document.getElementById('doors');
const logEl = document.getElementById('log');
const enemiesCount = document.getElementById('enemies');
const startBtn = document.getElementById('startBtn');
const toggleCamBtn = document.getElementById('toggleCam');
const closeLeftBtn = document.getElementById('closeLeft');
const closeRightBtn = document.getElementById('closeRight');

const modal = document.getElementById('modal');
const qText = document.getElementById('qText');
const qInput = document.getElementById('qInput');
const qTime = document.getElementById('qTime');
const submitAns = document.getElementById('submitAns');

/* Canvaslar */
const cams = {
  A: document.getElementById('camA'),
  B: document.getElementById('camB'),
  C: document.getElementById('camC'),
  D: document.getElementById('camD'),
};
Object.values(cams).forEach(c=>{ c.width = 600; c.height=360; });

/* --- Yardımcılar --- */
function log(msg){
  const t = new Date().toLocaleTimeString();
  logEl.innerHTML = `[${t}] ${msg}\n` + logEl.innerHTML;
}
function clamp(v,a,b){return Math.max(a,Math.min(b,v));}
function rand(min,max){ return Math.random()*(max-min)+min; }

/* --- Animatronik model --- */
function createEnemies(n){
  const arr = [];
  for(let i=0;i<n;i++){
    arr.push({
      id: i,
      name: ["Bunny","Wolf","Crow"][i%3]+"#"+(i+1),
      // position 0 (stage) ... 1 (at door)
      pos: Math.random()*0.25,
      speed: 0.004 + Math.random()*0.007,
      active: true,
      pausedUntil: 0
    });
  }
  return arr;
}

/* --- Soru üretici --- */
function generateQuestion(difficulty=1){
  // difficulty ile sayı aralığını büyüt
  const max = 5 + difficulty*8;
  const a = Math.floor(rand(1,max));
  const b = Math.floor(rand(1,max));
  const op = Math.random() < 0.5 ? '+' : '*';
  const text = `${a} ${op} ${b} = ?`;
  const answer = op === '+' ? a+b : a*b;
  return {text,answer};
}

/* --- Oyun başlangıcı --- */
function startGame(){
  if(state.running) return;
  state.running = true;
  state.timeLeft = NIGHT_SECONDS;
  state.energy = INITIAL_ENERGY;
  state.cameraOn = false;
  state.doorLeft = false;
  state.doorRight = false;
  state.enemies = createEnemies(ANIM_COUNT);
  enemiesCount.innerText = state.enemies.length;
  startBtn.innerText = "Yeniden Başlat";
  log("Gece başladı. Hazır ol.");
  updateUI();
  drawAll();
  // ana tick: 200ms
  state.tickInterval = setInterval(tick, 200);
}

/* --- Oyun bittikten sonra temizle --- */
function endGame(win,reason){
  clearInterval(state.tickInterval);
  state.running = false;
  modal.style.display = 'none';
  const msg = win ? `GECEYİ KAZANDIN! (${reason})` : `OYUN BİTTİ — ${reason}`;
  log(msg);
  alert(msg + "\nSayfayı yenileyip tekrar oynayabilirsin.");
}

/* --- Her tick --- */
let lastTick = Date.now();
function tick(){
  const now = Date.now();
  const dt = (now - lastTick)/1000; lastTick = now;

  // zaman
  state.timeLeft -= dt;
  if(state.timeLeft <= 0){
    endGame(true,"Sabah oldu");
    updateUI();
    return;
  }

  // enerji yönetimi
  if(state.cameraOn) state.energy -= ENERGY_CAMERA_PER_SEC * dt;
  if(state.doorLeft) state.energy -= ENERGY_DOOR_PER_SEC * dt;
  if(state.doorRight) state.energy -= ENERGY_DOOR_PER_SEC * dt;
  state.energy = clamp(state.energy,0,100);
  if(state.energy <= 0){
    // enerji bitti => hayatta kalamazsın
    endGame(false,"Enerji bitti");
    return;
  }

  // animatronikler hareketi
  for(const e of state.enemies){
    if(!e.active) continue;
    // e.pausedUntil ile soru sonrası duraklama
    if(now < e.pausedUntil) continue;
    // kamera açıksa hareket yavaşlar
    const cameraMultiplier = state.cameraOn ? 0.25 : 1;
    // kapı kapalıysa o kapıda bulunan animatronik geri durur
    const atLeftDoor = e.pos > 0.8 && !state.doorLeft ? true : false;
    // ilerleme
    e.pos += e.speed * cameraMultiplier * dt;
    // rastgele artış
    if(Math.random() < 0.01) e.pos += e.speed*1.4*dt;
    // clamp
    e.pos = clamp(e.pos, 0, 1.05);

    // eğer kapıya ulaşırsa soru sorma veya saldırı
    if(e.pos >= 1.0){
      // eğer kapı kapalıysa geri it
      if(state.doorLeft || state.doorRight){
        // Kapı hangi tarafta? basitçe yarıya göre
        if(e.pos >= 1.0 && e.pos < 1.05){
          // soru sor — matematikle geri gönder
          askQuestion(e);
        }
      } else {
        // kapı kapalı değilse saldırı => oyun bitti
        endGame(false, `${e.name} kapıyı aştı!`);
        return;
      }
    }
  }

  // update UI ve çizim
  updateUI();
  drawAll();
}

/* --- Soru gösterimi --- */
function askQuestion(enemy){
  if(state.Q) return; // zaten açık soru varsa yeni sormuyoruz
  const difficulty = 1 + Math.floor(enemy.pos*4);
  const q = generateQuestion(difficulty);
  state.Q = {enemy, q, timeLeft: QUESTION_TIME, started: Date.now()};
  qText.innerText = `Animatronik ${enemy.name} yaklaştı! Soruyu çöz:\n${q.text}`;
  qInput.value = '';
  qTime.innerText = Math.ceil(state.Q.timeLeft);
  modal.style.display = 'flex';
  qInput.focus();
  log(`${enemy.name} için soru: ${q.text}`);

  // soru zamanlayıcı
  const qtick = setInterval(()=>{
    if(!state.Q){ clearInterval(qtick); return; }
    state.Q.timeLeft -= 0.5;
    qTime.innerText = Math.ceil(state.Q.timeLeft);
    if(state.Q.timeLeft <= 0){
      clearInterval(qtick);
      // yanlış say => saldırı
      modal.style.display = 'none';
      state.Q = null;
      endGame(false, `${enemy.name} soruya cevap verilmedi, saldırdı.`);
    }
  },500);
}

/* --- cevap kontrol --- */
function submitAnswer(){
  if(!state.Q) return;
  const given = qInput.value.trim();
  if(given === '') return;
  const correct = String(state.Q.q.answer);
  const enemy = state.Q.enemy;
  if(given === correct){
    // başarılı: animatronik geri gider (pos azalt)
    enemy.pos = Math.max(0, enemy.pos - 0.45);
    enemy.pausedUntil = Date.now() + 4000; // 4s duraksama
    modal.style.display = 'none';
    log(`${enemy.name} soruyu yanlışsız çözüldü — geri çekildi.`);
    state.Q = null;
  } else {
    modal.style.display = 'none';
    state.Q = null;
    endGame(false, `${enemy.name} soruya yanlış cevap verildi.`);
  }
}

/* --- UI güncelle --- */
function updateUI(){
  timerEl.innerText = Math.ceil(state.timeLeft);
  energyBar.style.width = `${state.energy}%`;
  energyPercent.innerText = `${Math.ceil(state.energy)}%`;
  camState.innerText = state.cameraOn ? "Açık" : "Kapalı";
  doorsEl.innerText = `${state.doorLeft ? 'Kapalı' : 'Açık'} / ${state.doorRight ? 'Kapalı' : 'Açık'}`;
  enemiesCount.innerText = state.enemies.length;
}

/* --- Basit çizim: kameralar ve animatronikler --- */
function drawAll(){
  // her kamera farklı açı gösterir, ama basit olacak
  drawCam(cams.A.getContext('2d'), 'A', 0);
  drawCam(cams.B.getContext('2d'), 'B', 1);
  drawCam(cams.C.getContext('2d'), 'C', 2);
  drawCam(cams.D.getContext('2d'), 'D', 3);
}

function drawCam(ctx, id, camIndex){
  const w = ctx.canvas.width; const h = ctx.canvas.height;
  ctx.clearRect(0,0,w,h);
  // grain & vignette
  ctx.fillStyle = '#061018';
  ctx.fillRect(0,0,w,h);
  // draw stage/floor
  ctx.fillStyle = '#07121a';
  ctx.fillRect(0,h*0.6,w,h*0.4);
  // draw animatronikler small depending on camIndex: show subset
  const visible = state.enemies.filter((e,idx)=> (idx%4) === camIndex || camIndex===3);
  visible.forEach((e,idx)=>{
    // position horizontally by e.id
    const x = (w*0.15) + (e.id*(w*0.25)) + Math.sin(Date.now()/400 + e.id)*8;
    const y = h*0.5 + e.pos*h*0.4;
    // body
    const size = 36 + e.pos*40;
    const red = Math.floor(120 + e.id*40);
    ctx.beginPath();
    ctx.fillStyle = `rgba(${red},${40},${40},0.95)`;
    ctx.arc(x,y,size*0.6,0,Math.PI*2);
    ctx.fill();
    // eyes (glow more when near)
    const eyeGlow = Math.min(1, e.pos*2);
    ctx.beginPath();
    ctx.fillStyle = `rgba(255,${150*Math.max(0,1-eyeGlow)},${50},${0.7+eyeGlow*0.3})`;
    ctx.arc(x - size*0.2, y - size*0.1, 6 + eyeGlow*6, 0, Math.PI*2);
    ctx.arc(x + size*0.2, y - size*0.1, 6 + eyeGlow*6, 0, Math.PI*2);
    ctx.fill();
  });
  // overlay (scan lines)
  ctx.fillStyle = 'rgba(0,0,0,0.12)';
  for(let i=0;i<h;i+=6){ ctx.fillRect(0,i,w,1); }
  // timestamp
  ctx.fillStyle = 'rgba(180,200,220,0.8)';
  ctx.font = '14px monospace';
  ctx.fillText(new Date().toLocaleTimeString(), 10, 20);
}

/* --- Kontroller --- */
toggleCamBtn.addEventListener('click', ()=>{
  if(!state.running) return log("Önce başlat.");
  state.cameraOn = !state.cameraOn;
  log(`Kamera ${state.cameraOn ? 'Açıldı' : 'Kapatıldı'}.`);
  updateUI();
});

closeLeftBtn.addEventListener('click', ()=>{
  if(!state.running) return log("Önce başlat.");
  // toggle
  state.doorLeft = !state.doorLeft;
  log(`Sol kapı ${state.doorLeft ? 'kapatıldı' : 'açıldı'}.`);
  updateUI();
});

closeRightBtn.addEventListener('click', ()=>{
  if(!state.running) return log("Önce başlat.");
  state.doorRight = !state.doorRight;
  log(`Sağ kapı ${state.doorRight ? 'kapatıldı' : 'açıldı'}.`);
  updateUI();
});

startBtn.addEventListener('click', ()=> startGame());

submitAns.addEventListener('click', submitAnswer);
qInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') submitAnswer(); });

// prevent focus escape so mobile works nicely
modal.addEventListener('click', (e)=>{ if(e.target === modal){} });

/* --- Başlangıç çizimi --- */
drawAll();
log("Sayfaya hoş geldin. 'Başla' düğmesine bas ve geceyi geçir.");

/* --- Not: Eğer oyun çok kolay/çok zor gelirse oynanış değerlerini yukarıda değiştir --- */
</script>
</body>
</html>
